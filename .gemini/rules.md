# FlashEditor プロジェクトルール

## プロジェクト概要

- **名前**: FlashEditor
- **種類**: Windows Forms デスクトップアプリケーション（軽量メモアプリ）
- **フレームワーク**: .NET 9.0 (Windows Forms)
- **言語**: C#
- **最低サポートOS**: Windows 10
- **ライセンス**: GPL

---

## コーディング規約

### 命名規則（C# 標準に準拠）

| 対象                   | スタイル                     | 例                                 |
| ---------------------- | ---------------------------- | ---------------------------------- |
| クラス / 構造体        | PascalCase                   | `AppConfig`, `HistoryManager`      |
| パブリックメソッド     | PascalCase                   | `SaveData()`, `LoadConfig()`       |
| パブリックプロパティ   | PascalCase                   | `FontName`, `WindowWidth`          |
| プライベートフィールド | `_camelCase`                 | `_undoStack`, `_redoStack`         |
| ローカル変数           | camelCase                    | `filePath`, `undoCount`            |
| パラメータ             | camelCase                    | `currentText`, `filePath`          |
| 定数                   | PascalCase                   | `MaxHistory`, `MinChangeThreshold` |
| インターフェース       | `I` + PascalCase             | `IDataService`                     |
| 列挙型                 | PascalCase（型名・値ともに） | `ThemeMode.Dark`                   |
| 名前空間               | PascalCase                   | `FlashEditor`                      |

### `var` の使用

- 右辺から型が明確な場合は `var` を使用する。
- 型が不明確な場合は明示的に型を記述する。

```csharp
// OK: 右辺から型が明確
var list = new List<string>();
var json = File.ReadAllText(path);

// OK: 型を明示した方がわかりやすい場合
int count = GetItemCount();
```

### コメント

- コードの意図が分かりにくい箇所には、日本語で1行コメントを付ける。
- プログラム初心者でもわかるように、難しいロジックには特に丁寧にコメントする。
- XMLドキュメントコメント (`///`) は公開APIに付ける。

### ファイル構成

- 原則として **1ファイル1クラス** とする。
- ファイル名はクラス名と一致させる（例: `HistoryManager` → `HistoryManager.cs`）。
- WinForms のDesigner生成ファイル (`*.Designer.cs`) は手動で編集しない。

---

## アーキテクチャ

### 設計方針

- シンプルなWinFormsアプリとして、過度な抽象化は避ける。
- ビジネスロジックとUI処理は可能な限り分離する。
- 再利用可能な処理はユーティリティクラスやヘルパーメソッドに切り出す。

### テーマ対応

- **ダークモード・ライトモードの両方に必ず対応** する。
- 新しいUI要素を追加する場合は、`ThemeManager` を通してテーマを適用すること。

### アイコン

- コード描画（ベクター描画）と画像ファイルの両方を使用可能。
- 新規アイコンはどちらの方法でも構わないが、既存のスタイルとの一貫性を意識する。

---

## テスト

### テストフレームワーク

- **xUnit** を使用する。
- テストプロジェクト: `FlashEditor.Tests`

### 命名規則

- テストクラス名: `対象クラス名Tests`（例: `HistoryManagerTests`）
- テストメソッド名: `メソッド名_条件_期待結果` 形式

```csharp
// 例
public class HistoryManagerTests
{
    [Fact]
    public void Push_SameText_DoesNotAddDuplicate() { ... }

    [Fact]
    public void Undo_WhenStackEmpty_ReturnsCurrentText() { ... }
}
```

### テストの必須要件

- **新機能を追加する場合はユニットテストを必ず作成する。**
- テスト可能なロジック（UIに依存しない部分）を優先的にテストする。

---

## Git / バージョン管理

### コミットメッセージ

Conventional Commits 規約に従い、**日本語** で記述する。
ユーザーに提案する場合は、一つずつテキストベースでコピペできるように出力してください。

- **形式**: `<type>: <subject>`
- `subject` は日本語で簡潔に変更内容を記述する。

| type       | 用途                                     |
| ---------- | ---------------------------------------- |
| `feat`     | 新しい機能の追加                         |
| `fix`      | バグの修正                               |
| `docs`     | ドキュメントのみの変更                   |
| `style`    | 空白、フォーマット、セミコロン追加など   |
| `refactor` | 仕様に影響がないコード改善（リファクタ） |
| `perf`     | パフォーマンス向上関連                   |
| `test`     | テスト関連                               |
| `chore`    | ビルド、補助ツール、ライブラリ関連       |

**良い例:**

- `feat: ブログカードにキャッシュ機能を追加`
- `fix: Punycode変換でドメインが正しくデコードされない問題を修正`
- `refactor: ショートコード処理の共通部分を関数に切り出し`

**悪い例:**

- `fix: バグ修正` （具体性がなく何を修正したか分からない）
- `update` （type が規約に沿っておらず、内容も不明）

---

## データ / ファイル

- 設定ファイルのフォーマット: **JSON**
- 文字エンコーディング: **UTF-8** で統一
- データファイルの保存先: アプリケーションの実行ディレクトリ

---

## 外部ライブラリ

- NuGet パッケージの追加に特別な制限はない。
- ただし、追加時には目的と理由をコミットメッセージに記載する。

---

## AI アシスタントへの指示

- 思考過程も含めて、AIチャットの出力はできる限り **日本語** で行う。
- 変更プラン・ウォークスルー等のドキュメントも **日本語** で出力する。
- プログラム初心者でもわかるように、難しいコード部分には **日本語の1行コメント** を付ける。
- 最高の結果を出すために、追加で必要な情報があれば事前に質問する。
